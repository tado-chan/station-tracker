{"ast":null,"code":"import _asyncToGenerator from \"/mnt/c/Users/aluta/station-tracker/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { IonicModule } from '@ionic/angular';\nimport { StationService } from '../../services/station.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/station.service\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"@ionic/angular\";\nfunction HistoryPage_ion_card_7_div_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 9)(1, \"ion-text\", 15)(2, \"h3\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"ion-text\", 11)(5, \"p\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r0.stats.most_visited.station__name);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"\\u6700\\u591A\\u8A2A\\u554F\\u99C5 (\", ctx_r0.stats.most_visited.visit_count, \"\\u56DE)\");\n  }\n}\nfunction HistoryPage_ion_card_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-card\")(1, \"ion-card-header\")(2, \"ion-card-title\");\n    i0.ɵɵtext(3, \"\\u7D71\\u8A08\\u60C5\\u5831\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"ion-card-content\")(5, \"div\", 8)(6, \"div\", 9)(7, \"ion-text\", 10)(8, \"h2\");\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(10, \"ion-text\", 11)(11, \"p\");\n    i0.ɵɵtext(12, \"\\u7DCF\\u8A2A\\u554F\\u56DE\\u6570\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(13, \"div\", 9)(14, \"ion-text\", 12)(15, \"h2\");\n    i0.ɵɵtext(16);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(17, \"ion-text\", 11)(18, \"p\");\n    i0.ɵɵtext(19, \"\\u8A2A\\u554F\\u99C5\\u6570\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(20, \"div\", 9)(21, \"ion-text\", 13)(22, \"h2\");\n    i0.ɵɵtext(23);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(24, \"ion-text\", 11)(25, \"p\");\n    i0.ɵɵtext(26, \"\\u5E73\\u5747\\u6EDE\\u5728\\u6642\\u9593(\\u5206)\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵtemplate(27, HistoryPage_ion_card_7_div_27_Template, 7, 2, \"div\", 14);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(9);\n    i0.ɵɵtextInterpolate(ctx_r0.stats.total_visits);\n    i0.ɵɵadvance(7);\n    i0.ɵɵtextInterpolate(ctx_r0.stats.unique_stations);\n    i0.ɵɵadvance(7);\n    i0.ɵɵtextInterpolate(ctx_r0.Math.round(ctx_r0.stats.avg_duration));\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.stats.most_visited);\n  }\n}\nfunction HistoryPage_ion_select_option_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-select-option\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const period_r2 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", period_r2.value);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", period_r2.label, \" \");\n  }\n}\nfunction HistoryPage_ion_item_22_ion_select_option_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-select-option\", 16);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const station_r4 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", station_r4);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", station_r4, \" \");\n  }\n}\nfunction HistoryPage_ion_item_22_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-item\")(1, \"ion-label\");\n    i0.ɵɵtext(2, \"\\u99C5\\u3067\\u7D5E\\u308A\\u8FBC\\u307F\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"ion-select\", 2);\n    i0.ɵɵtwoWayListener(\"ngModelChange\", function HistoryPage_ion_item_22_Template_ion_select_ngModelChange_3_listener($event) {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r0 = i0.ɵɵnextContext();\n      i0.ɵɵtwoWayBindingSet(ctx_r0.selectedStation, $event) || (ctx_r0.selectedStation = $event);\n      return i0.ɵɵresetView($event);\n    });\n    i0.ɵɵlistener(\"selectionChange\", function HistoryPage_ion_item_22_Template_ion_select_selectionChange_3_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.filterVisits());\n    });\n    i0.ɵɵelementStart(4, \"ion-select-option\", 17);\n    i0.ɵɵtext(5, \"\\u3059\\u3079\\u3066\\u306E\\u99C5\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(6, HistoryPage_ion_item_22_ion_select_option_6_Template, 2, 2, \"ion-select-option\", 3);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtwoWayProperty(\"ngModel\", ctx_r0.selectedStation);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.getUniqueStations());\n  }\n}\nfunction HistoryPage_ion_item_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-item\")(1, \"ion-label\")(2, \"p\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"\", ctx_r0.filteredVisits.length, \"\\u4EF6\\u306E\\u8A18\\u9332\\u304C\\u898B\\u3064\\u304B\\u308A\\u307E\\u3057\\u305F\");\n  }\n}\nfunction HistoryPage_div_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 18);\n    i0.ɵɵelement(1, \"ion-spinner\", 19);\n    i0.ɵɵelementStart(2, \"p\");\n    i0.ɵɵtext(3, \"\\u8AAD\\u307F\\u8FBC\\u307F\\u4E2D...\");\n    i0.ɵɵelementEnd()();\n  }\n}\nfunction HistoryPage_ion_list_25_ion_card_1_p_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\", 32);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const visit_r6 = i0.ɵɵnextContext().$implicit;\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \\u6EDE\\u5728\\u6642\\u9593: \", ctx_r0.formatDuration(visit_r6.duration_minutes), \" \");\n  }\n}\nfunction HistoryPage_ion_list_25_ion_card_1_div_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 33)(1, \"ion-chip\", 11);\n    i0.ɵɵelement(2, \"ion-icon\", 34);\n    i0.ɵɵelementStart(3, \"ion-label\");\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const visit_r6 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(visit_r6.weather);\n  }\n}\nfunction HistoryPage_ion_list_25_ion_card_1_div_14_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 35)(1, \"ion-text\", 11)(2, \"p\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const visit_r6 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(visit_r6.notes);\n  }\n}\nfunction HistoryPage_ion_list_25_ion_card_1_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-card\")(1, \"ion-card-content\")(2, \"div\", 21)(3, \"div\", 22);\n    i0.ɵɵelement(4, \"ion-icon\", 23);\n    i0.ɵɵelementStart(5, \"div\", 24)(6, \"h3\");\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"p\", 25);\n    i0.ɵɵtext(9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(10, HistoryPage_ion_list_25_ion_card_1_p_10_Template, 2, 1, \"p\", 26);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"ion-button\", 27);\n    i0.ɵɵlistener(\"click\", function HistoryPage_ion_list_25_ion_card_1_Template_ion_button_click_11_listener() {\n      const visit_r6 = i0.ɵɵrestoreView(_r5).$implicit;\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.deleteVisit(visit_r6));\n    });\n    i0.ɵɵelement(12, \"ion-icon\", 28);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(13, HistoryPage_ion_list_25_ion_card_1_div_13_Template, 5, 1, \"div\", 29)(14, HistoryPage_ion_list_25_ion_card_1_div_14_Template, 4, 1, \"div\", 30);\n    i0.ɵɵelementStart(15, \"div\", 31)(16, \"ion-text\", 11)(17, \"small\");\n    i0.ɵɵtext(18);\n    i0.ɵɵelementEnd()()()()();\n  }\n  if (rf & 2) {\n    const visit_r6 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"name\", ctx_r0.getVisitIcon(visit_r6))(\"color\", ctx_r0.getVisitColor(visit_r6));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"\", (visit_r6.station_data == null ? null : visit_r6.station_data.name) || \"\\u4E0D\\u660E\\u306A\\u99C5\", \"\\u99C5\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r0.formatDateTime(visit_r6.arrived_at));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", visit_r6.duration_minutes);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", visit_r6.weather);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", visit_r6.notes);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate2(\" \\u4F4D\\u7F6E: \", visit_r6.latitude.toFixed(6), \", \", visit_r6.longitude.toFixed(6), \" \");\n  }\n}\nfunction HistoryPage_ion_list_25_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-list\");\n    i0.ɵɵtemplate(1, HistoryPage_ion_list_25_ion_card_1_Template, 19, 9, \"ion-card\", 20);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.getPaginatedVisits());\n  }\n}\nfunction HistoryPage_div_26_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r7 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 36)(1, \"ion-button\", 37);\n    i0.ɵɵlistener(\"click\", function HistoryPage_div_26_Template_ion_button_click_1_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.previousPage());\n    });\n    i0.ɵɵelement(2, \"ion-icon\", 38);\n    i0.ɵɵtext(3, \" \\u524D\\u3078 \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"ion-text\", 11)(5, \"span\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"ion-button\", 37);\n    i0.ɵɵlistener(\"click\", function HistoryPage_div_26_Template_ion_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r7);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.nextPage());\n    });\n    i0.ɵɵtext(8, \" \\u6B21\\u3078 \");\n    i0.ɵɵelement(9, \"ion-icon\", 39);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", !ctx_r0.hasPreviousPage());\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate2(\"\", ctx_r0.currentPage + 1, \" / \", ctx_r0.Math.ceil(ctx_r0.filteredVisits.length / ctx_r0.pageSize));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", !ctx_r0.hasNextPage());\n  }\n}\nfunction HistoryPage_ion_card_27_p_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1, \"\\u307E\\u3060\\u99C5\\u3092\\u8A2A\\u554F\\u3057\\u3066\\u3044\\u307E\\u305B\\u3093\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction HistoryPage_ion_card_27_p_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1, \"\\u30D5\\u30A3\\u30EB\\u30BF\\u30FC\\u6761\\u4EF6\\u306B\\u4E00\\u81F4\\u3059\\u308B\\u8A18\\u9332\\u304C\\u3042\\u308A\\u307E\\u305B\\u3093\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction HistoryPage_ion_card_27_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-card\")(1, \"ion-card-content\", 40);\n    i0.ɵɵelement(2, \"ion-icon\", 41);\n    i0.ɵɵelementStart(3, \"h2\");\n    i0.ɵɵtext(4, \"\\u8A18\\u9332\\u304C\\u3042\\u308A\\u307E\\u305B\\u3093\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(5, HistoryPage_ion_card_27_p_5_Template, 2, 0, \"p\", 1)(6, HistoryPage_ion_card_27_p_6_Template, 2, 0, \"p\", 1);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.visits.length === 0);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.visits.length > 0);\n  }\n}\nexport let HistoryPage = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class HistoryPage {\n    constructor(stationService) {\n      this.stationService = stationService;\n      this.visits = [];\n      this.stats = null;\n      this.filteredVisits = [];\n      this.loading = false;\n      this.Math = Math;\n      // Filter options\n      this.selectedPeriod = 'all';\n      this.searchQuery = '';\n      this.selectedStation = null;\n      // Pagination\n      this.currentPage = 0;\n      this.pageSize = 20;\n      this.periods = [{\n        value: 'all',\n        label: 'すべて'\n      }, {\n        value: 'today',\n        label: '今日'\n      }, {\n        value: 'week',\n        label: '今週'\n      }, {\n        value: 'month',\n        label: '今月'\n      }, {\n        value: 'year',\n        label: '今年'\n      }];\n    }\n    ngOnInit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        yield _this.loadData();\n      })();\n    }\n    loadData() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        _this2.loading = true;\n        try {\n          yield Promise.all([_this2.loadVisits(), _this2.loadStats()]);\n        } finally {\n          _this2.loading = false;\n        }\n      })();\n    }\n    loadVisits() {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          _this3.visits = (yield _this3.stationService.getUserVisits().toPromise()) || [];\n          _this3.filterVisits();\n        } catch (error) {\n          console.error('Failed to load visits:', error);\n        }\n      })();\n    }\n    loadStats() {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          _this4.stats = (yield _this4.stationService.getVisitStats().toPromise()) || null;\n        } catch (error) {\n          console.error('Failed to load stats:', error);\n        }\n      })();\n    }\n    onPeriodChange() {\n      var _this5 = this;\n      return _asyncToGenerator(function* () {\n        yield _this5.filterByPeriod();\n      })();\n    }\n    onSearchInput(event) {\n      var _this6 = this;\n      return _asyncToGenerator(function* () {\n        _this6.searchQuery = event.target.value.toLowerCase();\n        _this6.filterVisits();\n      })();\n    }\n    filterByPeriod() {\n      var _this7 = this;\n      return _asyncToGenerator(function* () {\n        _this7.loading = true;\n        try {\n          if (_this7.selectedPeriod === 'all') {\n            _this7.visits = (yield _this7.stationService.getUserVisits().toPromise()) || [];\n          } else {\n            const {\n              startDate,\n              endDate\n            } = _this7.getPeriodDates(_this7.selectedPeriod);\n            _this7.visits = (yield _this7.stationService.getVisitsByDateRange(startDate.toISOString(), endDate.toISOString()).toPromise()) || [];\n          }\n          _this7.filterVisits();\n        } catch (error) {\n          console.error('Failed to filter visits:', error);\n        } finally {\n          _this7.loading = false;\n        }\n      })();\n    }\n    getPeriodDates(period) {\n      const now = new Date();\n      const endDate = new Date(now);\n      let startDate;\n      switch (period) {\n        case 'today':\n          startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n          break;\n        case 'week':\n          startDate = new Date(now);\n          startDate.setDate(now.getDate() - 7);\n          break;\n        case 'month':\n          startDate = new Date(now.getFullYear(), now.getMonth(), 1);\n          break;\n        case 'year':\n          startDate = new Date(now.getFullYear(), 0, 1);\n          break;\n        default:\n          startDate = new Date(0);\n      }\n      return {\n        startDate,\n        endDate\n      };\n    }\n    filterVisits() {\n      this.filteredVisits = this.visits.filter(visit => {\n        const matchesSearch = !this.searchQuery || visit.station_data?.name.toLowerCase().includes(this.searchQuery) || visit.station_data?.name_kana.toLowerCase().includes(this.searchQuery) || visit.notes?.toLowerCase().includes(this.searchQuery);\n        const matchesStation = !this.selectedStation || visit.station_data?.name === this.selectedStation;\n        return matchesSearch && matchesStation;\n      });\n      // Reset pagination\n      this.currentPage = 0;\n    }\n    getPaginatedVisits() {\n      const startIndex = this.currentPage * this.pageSize;\n      const endIndex = startIndex + this.pageSize;\n      return this.filteredVisits.slice(startIndex, endIndex);\n    }\n    hasNextPage() {\n      return (this.currentPage + 1) * this.pageSize < this.filteredVisits.length;\n    }\n    hasPreviousPage() {\n      return this.currentPage > 0;\n    }\n    nextPage() {\n      if (this.hasNextPage()) {\n        this.currentPage++;\n      }\n    }\n    previousPage() {\n      if (this.hasPreviousPage()) {\n        this.currentPage--;\n      }\n    }\n    deleteVisit(visit) {\n      var _this8 = this;\n      return _asyncToGenerator(function* () {\n        if (!visit.id) return;\n        try {\n          yield _this8.stationService.deleteVisit(visit.id).toPromise();\n          _this8.visits = _this8.visits.filter(v => v.id !== visit.id);\n          _this8.filterVisits();\n          yield _this8.loadStats(); // Refresh stats\n        } catch (error) {\n          console.error('Failed to delete visit:', error);\n        }\n      })();\n    }\n    formatDateTime(dateString) {\n      const date = new Date(dateString);\n      return date.toLocaleString('ja-JP', {\n        year: 'numeric',\n        month: '2-digit',\n        day: '2-digit',\n        hour: '2-digit',\n        minute: '2-digit'\n      });\n    }\n    formatDuration(minutes) {\n      if (!minutes) return '未設定';\n      if (minutes < 60) {\n        return `${minutes}分`;\n      } else {\n        const hours = Math.floor(minutes / 60);\n        const remainingMinutes = minutes % 60;\n        return `${hours}時間${remainingMinutes > 0 ? remainingMinutes + '分' : ''}`;\n      }\n    }\n    getUniqueStations() {\n      const stations = new Set(this.visits.map(visit => visit.station_data?.name).filter(name => name !== undefined));\n      return Array.from(stations).sort();\n    }\n    doRefresh(event) {\n      var _this9 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          yield _this9.loadData();\n        } finally {\n          event.target.complete();\n        }\n      })();\n    }\n    getVisitIcon(visit) {\n      if (visit.duration_minutes && visit.duration_minutes > 0) {\n        return 'time';\n      }\n      return 'location';\n    }\n    getVisitColor(visit) {\n      if (!visit.duration_minutes) return 'medium';\n      if (visit.duration_minutes < 5) return 'warning';\n      if (visit.duration_minutes < 30) return 'primary';\n      return 'success';\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function HistoryPage_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || HistoryPage)(i0.ɵɵdirectiveInject(i1.StationService));\n    }, this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: HistoryPage,\n      selectors: [[\"app-history\"]],\n      decls: 28,\n      vars: 10,\n      consts: [[\"slot\", \"fixed\", 3, \"ionRefresh\"], [4, \"ngIf\"], [\"interface\", \"popover\", 3, \"ngModelChange\", \"selectionChange\", \"ngModel\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"position\", \"floating\"], [\"clearInput\", \"true\", 3, \"ngModelChange\", \"ionInput\", \"ngModel\"], [\"class\", \"loading-container\", 4, \"ngIf\"], [\"class\", \"pagination\", 4, \"ngIf\"], [1, \"stats-grid\"], [1, \"stat-item\"], [\"color\", \"primary\"], [\"color\", \"medium\"], [\"color\", \"success\"], [\"color\", \"tertiary\"], [\"class\", \"stat-item\", 4, \"ngIf\"], [\"color\", \"warning\"], [3, \"value\"], [\"value\", \"\"], [1, \"loading-container\"], [\"name\", \"dots\"], [4, \"ngFor\", \"ngForOf\"], [1, \"visit-header\"], [1, \"visit-info\"], [\"size\", \"large\", 3, \"name\", \"color\"], [1, \"visit-details\"], [1, \"visit-time\"], [\"class\", \"duration\", 4, \"ngIf\"], [\"fill\", \"clear\", \"color\", \"danger\", 3, \"click\"], [\"name\", \"trash\", \"slot\", \"icon-only\"], [\"class\", \"visit-meta\", 4, \"ngIf\"], [\"class\", \"visit-notes\", 4, \"ngIf\"], [1, \"visit-location\"], [1, \"duration\"], [1, \"visit-meta\"], [\"name\", \"partly-sunny\"], [1, \"visit-notes\"], [1, \"pagination\"], [\"fill\", \"outline\", 3, \"click\", \"disabled\"], [\"name\", \"chevron-back\", \"slot\", \"start\"], [\"name\", \"chevron-forward\", \"slot\", \"end\"], [1, \"empty-state\"], [\"name\", \"document-outline\", \"size\", \"large\", \"color\", \"medium\"]],\n      template: function HistoryPage_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"ion-header\")(1, \"ion-toolbar\")(2, \"ion-title\");\n          i0.ɵɵtext(3, \"\\u8A2A\\u554F\\u5C65\\u6B74\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(4, \"ion-content\")(5, \"ion-refresher\", 0);\n          i0.ɵɵlistener(\"ionRefresh\", function HistoryPage_Template_ion_refresher_ionRefresh_5_listener($event) {\n            return ctx.doRefresh($event);\n          });\n          i0.ɵɵelement(6, \"ion-refresher-content\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(7, HistoryPage_ion_card_7_Template, 28, 4, \"ion-card\", 1);\n          i0.ɵɵelementStart(8, \"ion-card\")(9, \"ion-card-header\")(10, \"ion-card-title\");\n          i0.ɵɵtext(11, \"\\u30D5\\u30A3\\u30EB\\u30BF\\u30FC\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(12, \"ion-card-content\")(13, \"ion-item\")(14, \"ion-label\");\n          i0.ɵɵtext(15, \"\\u671F\\u9593\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(16, \"ion-select\", 2);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function HistoryPage_Template_ion_select_ngModelChange_16_listener($event) {\n            i0.ɵɵtwoWayBindingSet(ctx.selectedPeriod, $event) || (ctx.selectedPeriod = $event);\n            return $event;\n          });\n          i0.ɵɵlistener(\"selectionChange\", function HistoryPage_Template_ion_select_selectionChange_16_listener() {\n            return ctx.onPeriodChange();\n          });\n          i0.ɵɵtemplate(17, HistoryPage_ion_select_option_17_Template, 2, 2, \"ion-select-option\", 3);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(18, \"ion-item\")(19, \"ion-label\", 4);\n          i0.ɵɵtext(20, \"\\u691C\\u7D22 (\\u99C5\\u540D\\u3001\\u30E1\\u30E2)\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(21, \"ion-input\", 5);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function HistoryPage_Template_ion_input_ngModelChange_21_listener($event) {\n            i0.ɵɵtwoWayBindingSet(ctx.searchQuery, $event) || (ctx.searchQuery = $event);\n            return $event;\n          });\n          i0.ɵɵlistener(\"ionInput\", function HistoryPage_Template_ion_input_ionInput_21_listener($event) {\n            return ctx.onSearchInput($event);\n          });\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(22, HistoryPage_ion_item_22_Template, 7, 2, \"ion-item\", 1);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(23, HistoryPage_ion_item_23_Template, 4, 1, \"ion-item\", 1)(24, HistoryPage_div_24_Template, 4, 0, \"div\", 6)(25, HistoryPage_ion_list_25_Template, 2, 1, \"ion-list\", 1)(26, HistoryPage_div_26_Template, 10, 4, \"div\", 7)(27, HistoryPage_ion_card_27_Template, 7, 2, \"ion-card\", 1);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵadvance(7);\n          i0.ɵɵproperty(\"ngIf\", ctx.stats);\n          i0.ɵɵadvance(9);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.selectedPeriod);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngForOf\", ctx.periods);\n          i0.ɵɵadvance(4);\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.searchQuery);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.getUniqueStations().length > 0);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.filteredVisits.length > 0);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.loading);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", !ctx.loading && ctx.getPaginatedVisits().length > 0);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.filteredVisits.length > ctx.pageSize);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", !ctx.loading && ctx.filteredVisits.length === 0);\n        }\n      },\n      dependencies: [CommonModule, i2.NgForOf, i2.NgIf, FormsModule, i3.NgControlStatus, i3.NgModel, IonicModule, i4.IonButton, i4.IonCard, i4.IonCardContent, i4.IonCardHeader, i4.IonCardTitle, i4.IonChip, i4.IonContent, i4.IonHeader, i4.IonIcon, i4.IonInput, i4.IonItem, i4.IonLabel, i4.IonList, i4.IonRefresher, i4.IonRefresherContent, i4.IonSelect, i4.IonSelectOption, i4.IonSpinner, i4.IonText, i4.IonTitle, i4.IonToolbar, i4.SelectValueAccessor, i4.TextValueAccessor],\n      styles: [\".empty-state[_ngcontent-%COMP%]{text-align:center;padding:2rem;color:var(--ion-color-medium)}.stat-item[_ngcontent-%COMP%]{text-align:center;padding:1rem}.stat-item[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:.5rem 0;font-size:2rem;font-weight:700}.stat-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;color:var(--ion-color-medium)}.pagination[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;gap:1rem;padding:1rem}.filters[_ngcontent-%COMP%]{padding:1rem}.visit-item[_ngcontent-%COMP%]{margin:.5rem 0}\"]\n    }));\n  }\n  _staticBlock();\n  return HistoryPage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}