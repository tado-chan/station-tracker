{"ast":null,"code":"import _asyncToGenerator from \"/mnt/c/Users/aluta/station-tracker/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { CommonModule } from '@angular/common';\nimport { IonHeader, IonToolbar, IonTitle, IonContent, IonButton, IonCard, IonCardContent, IonCardHeader, IonCardTitle, IonIcon, IonItem, IonLabel, IonBadge, IonList, IonProgressBar } from '@ionic/angular/standalone';\nimport { IntegratedGeofenceService } from '../../../services/integrated-geofence.service';\nimport { GeofenceManagerService } from '../../../services/geofence-manager.service';\nimport { CloudSyncService } from '../../../services/cloud-sync.service';\nimport { StationService } from '../../services/station.service';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../../services/integrated-geofence.service\";\nimport * as i2 from \"../../../services/geofence-manager.service\";\nimport * as i3 from \"../../../services/cloud-sync.service\";\nimport * as i4 from \"../../services/station.service\";\nimport * as i5 from \"@angular/common\";\nfunction HomePage_ion_card_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-card\")(1, \"ion-card-content\");\n    i0.ɵɵelement(2, \"ion-progress-bar\", 9);\n    i0.ɵɵelementStart(3, \"p\");\n    i0.ɵɵtext(4, \"\\u30B7\\u30B9\\u30C6\\u30E0\\u3092\\u521D\\u671F\\u5316\\u4E2D...\");\n    i0.ɵɵelementEnd()()();\n  }\n}\nfunction HomePage_div_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 10)(1, \"ion-item\", 11)(2, \"ion-label\");\n    i0.ɵɵtext(3, \"\\u30CD\\u30A4\\u30C6\\u30A3\\u30D6\\u30B8\\u30AA\\u30D5\\u30A7\\u30F3\\u30B9\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"ion-badge\", 12);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"ion-item\", 11)(7, \"ion-label\");\n    i0.ɵɵtext(8, \"\\u30D0\\u30C3\\u30AF\\u30B0\\u30E9\\u30A6\\u30F3\\u30C9\\u30E2\\u30FC\\u30C9\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"ion-badge\", 12);\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"ion-item\", 11)(12, \"ion-label\");\n    i0.ɵɵtext(13, \"\\u30AF\\u30E9\\u30A6\\u30C9\\u540C\\u671F\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"ion-badge\", 12);\n    i0.ɵɵtext(15);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"ion-item\", 11)(17, \"ion-label\");\n    i0.ɵɵtext(18, \"\\u30A2\\u30AF\\u30C6\\u30A3\\u30D6\\u9818\\u57DF\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"ion-badge\", 13);\n    i0.ɵɵtext(20);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"color\", ctx_r0.trackingStatus.nativeGeofencing ? \"success\" : \"medium\");\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.trackingStatus.nativeGeofencing ? \"ON\" : \"OFF\", \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"color\", ctx_r0.trackingStatus.backgroundMode ? \"success\" : \"medium\");\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.trackingStatus.backgroundMode ? \"ON\" : \"OFF\", \" \");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"color\", ctx_r0.getSyncStatusColor());\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.syncStatus.isOnline ? \"\\u30AA\\u30F3\\u30E9\\u30A4\\u30F3\" : \"\\u30AA\\u30D5\\u30E9\\u30A4\\u30F3\", \" \");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate2(\"\", ctx_r0.trackingStatus.activeRegions, \"/\", ctx_r0.geofenceStats.maxRegions);\n  }\n}\nfunction HomePage_div_20_p_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"date\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \\u6700\\u7D42\\u66F4\\u65B0: \", i0.ɵɵpipeBind2(2, 1, ctx_r0.trackingStatus.lastLocationUpdate, \"HH:mm:ss\"), \" \");\n  }\n}\nfunction HomePage_div_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14)(1, \"p\");\n    i0.ɵɵtext(2);\n    i0.ɵɵpipe(3, \"number\");\n    i0.ɵɵpipe(4, \"number\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(5, HomePage_div_20_p_5_Template, 3, 4, \"p\", 4);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate2(\"\\u73FE\\u5728\\u4F4D\\u7F6E: \", i0.ɵɵpipeBind2(3, 3, ctx_r0.currentLocation.latitude, \"1.6-6\"), \", \", i0.ɵɵpipeBind2(4, 6, ctx_r0.currentLocation.longitude, \"1.6-6\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.trackingStatus.lastLocationUpdate);\n  }\n}\nfunction HomePage_ion_card_21_ion_item_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-item\", 11)(1, \"ion-label\")(2, \"h3\");\n    i0.ɵɵtext(3, \"\\u6700\\u7D42\\u6700\\u9069\\u5316\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\");\n    i0.ɵɵtext(5);\n    i0.ɵɵpipe(6, \"date\");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(6, 1, ctx_r0.geofenceStats.lastOptimization, \"MM/dd HH:mm\"));\n  }\n}\nfunction HomePage_ion_card_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-card\")(1, \"ion-card-header\")(2, \"ion-card-title\");\n    i0.ɵɵtext(3, \"\\u30B7\\u30B9\\u30C6\\u30E0\\u7D71\\u8A08\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"ion-card-content\")(5, \"ion-item\", 11)(6, \"ion-label\")(7, \"h3\");\n    i0.ɵɵtext(8, \"\\u30B8\\u30AA\\u30D5\\u30A7\\u30F3\\u30B9\\u9818\\u57DF\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"p\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"ion-badge\", 12);\n    i0.ɵɵtext(12);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(13, \"ion-item\", 11)(14, \"ion-label\")(15, \"h3\");\n    i0.ɵɵtext(16, \"\\u5468\\u8FBA\\u99C5\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"p\");\n    i0.ɵɵtext(18);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(19, \"ion-item\", 11)(20, \"ion-label\")(21, \"h3\");\n    i0.ɵɵtext(22, \"\\u540C\\u671F\\u72B6\\u6CC1\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(23, \"p\");\n    i0.ɵɵtext(24);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(25, \"p\");\n    i0.ɵɵtext(26);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(27, \"ion-badge\", 12);\n    i0.ɵɵtext(28);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(29, HomePage_ion_card_21_ion_item_29_Template, 7, 4, \"ion-item\", 15);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(10);\n    i0.ɵɵtextInterpolate2(\"\", ctx_r0.geofenceStats.activeRegions, \" / \", ctx_r0.geofenceStats.maxRegions, \" \\u4F7F\\u7528\\u4E2D\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"color\", ctx_r0.getBatteryOptimizationColor());\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.trackingStatus.batteryOptimized ? \"\\u6700\\u9069\\u5316\\u6E08\\u307F\" : \"\\u8981\\u6700\\u9069\\u5316\", \" \");\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate2(\"\", ctx_r0.geofenceStats.nearbyStations, \" / \", ctx_r0.geofenceStats.totalStations, \" \\u99C5\");\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate1(\"\\u672A\\u9001\\u4FE1: \", ctx_r0.syncStatus.pendingEvents, \"\\u4EF6\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\\u30A8\\u30E9\\u30FC: \", ctx_r0.syncStatus.syncErrors, \"\\u4EF6\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"color\", ctx_r0.getSyncStatusColor());\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.syncStatus.totalEventsSynced, \"\\u4EF6\\u540C\\u671F\\u6E08\\u307F \");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.geofenceStats.lastOptimization);\n  }\n}\nfunction HomePage_ion_card_22_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-card\")(1, \"ion-card-header\")(2, \"ion-card-title\");\n    i0.ɵɵtext(3, \"\\u624B\\u52D5\\u64CD\\u4F5C\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"ion-card-content\")(5, \"ion-button\", 16);\n    i0.ɵɵlistener(\"click\", function HomePage_ion_card_22_Template_ion_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.forceOptimization());\n    });\n    i0.ɵɵtext(6, \" \\u30B8\\u30AA\\u30D5\\u30A7\\u30F3\\u30B9\\u6700\\u9069\\u5316\\u5B9F\\u884C \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"ion-button\", 17);\n    i0.ɵɵlistener(\"click\", function HomePage_ion_card_22_Template_ion_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.forcSync());\n    });\n    i0.ɵɵtext(8, \" \\u30AF\\u30E9\\u30A6\\u30C9\\u540C\\u671F\\u5B9F\\u884C \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"ion-button\", 16);\n    i0.ɵɵlistener(\"click\", function HomePage_ion_card_22_Template_ion_button_click_9_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.getSystemStatus());\n    });\n    i0.ɵɵtext(10, \" \\u30B7\\u30B9\\u30C6\\u30E0\\u72B6\\u6CC1\\u8868\\u793A\\uFF08\\u30B3\\u30F3\\u30BD\\u30FC\\u30EB\\uFF09 \");\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"disabled\", !ctx_r0.syncStatus.isOnline);\n  }\n}\nfunction HomePage_ion_card_23_ion_item_6_p_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const station_r3 = i0.ɵɵnextContext().$implicit;\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\"\", ctx_r0.calculateDistance(station_r3), \"m\");\n  }\n}\nfunction HomePage_ion_card_23_ion_item_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-item\")(1, \"ion-label\")(2, \"h3\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(6, HomePage_ion_card_23_ion_item_6_p_6_Template, 2, 1, \"p\", 4);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const station_r3 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(station_r3.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(station_r3.line);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.calculateDistance(station_r3));\n  }\n}\nfunction HomePage_ion_card_23_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-card\")(1, \"ion-card-header\")(2, \"ion-card-title\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"ion-card-content\")(5, \"ion-list\");\n    i0.ɵɵtemplate(6, HomePage_ion_card_23_ion_item_6_Template, 7, 3, \"ion-item\", 18);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"\\u5468\\u8FBA\\u306E\\u99C5 (\", ctx_r0.nearbyStations.length, \"\\u4EF6)\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.nearbyStations.slice(0, 10));\n  }\n}\nfunction HomePage_ion_card_24_ion_item_6_p_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"p\");\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"date\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const visit_r4 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\"\\u51FA\\u767A: \", i0.ɵɵpipeBind2(2, 1, visit_r4.departed_at, \"HH:mm:ss\"));\n  }\n}\nfunction HomePage_ion_card_24_ion_item_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-item\")(1, \"ion-label\")(2, \"h3\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\");\n    i0.ɵɵtext(5);\n    i0.ɵɵpipe(6, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(7, HomePage_ion_card_24_ion_item_6_p_7_Template, 3, 4, \"p\", 4);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const visit_r4 = ctx.$implicit;\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(visit_r4.station_name || \"Unknown Station\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\\u5230\\u7740: \", i0.ɵɵpipeBind2(6, 3, visit_r4.arrived_at, \"HH:mm:ss\"));\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", visit_r4.departed_at);\n  }\n}\nfunction HomePage_ion_card_24_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"ion-card\")(1, \"ion-card-header\")(2, \"ion-card-title\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"ion-card-content\")(5, \"ion-list\");\n    i0.ɵɵtemplate(6, HomePage_ion_card_24_ion_item_6_Template, 8, 6, \"ion-item\", 18);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"\\u4ECA\\u65E5\\u306E\\u8A2A\\u554F\\u99C5 (\", ctx_r0.todayVisits.length, \"\\u4EF6)\");\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.todayVisits);\n  }\n}\nfunction HomePage_ion_card_25_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"ion-card\")(1, \"ion-card-content\", 19);\n    i0.ɵɵelement(2, \"ion-icon\", 20);\n    i0.ɵɵelementStart(3, \"h2\");\n    i0.ɵɵtext(4, \"\\u30D0\\u30C3\\u30AF\\u30B0\\u30E9\\u30A6\\u30F3\\u30C9\\u4F4D\\u7F6E\\u8FFD\\u8DE1\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"p\");\n    i0.ɵɵtext(6, \"\\u30A2\\u30D7\\u30EA\\u304C\\u30D0\\u30C3\\u30AF\\u30B0\\u30E9\\u30A6\\u30F3\\u30C9\\u3067\\u3082\\u99C5\\u3078\\u306E\\u5230\\u7740\\u30FB\\u51FA\\u767A\\u3092\\u81EA\\u52D5\\u8A18\\u9332\\u3057\\u307E\\u3059\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"ion-button\", 21);\n    i0.ɵɵlistener(\"click\", function HomePage_ion_card_25_Template_ion_button_click_7_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.toggleTracking());\n    });\n    i0.ɵɵelement(8, \"ion-icon\", 22);\n    i0.ɵɵtext(9, \" \\u8FFD\\u8DE1\\u958B\\u59CB \");\n    i0.ɵɵelementEnd()()();\n  }\n}\nexport let HomePage = /*#__PURE__*/(() => {\n  var _staticBlock;\n  class HomePage {\n    constructor(integratedGeofence, geofenceManager, cloudSync, stationService) {\n      this.integratedGeofence = integratedGeofence;\n      this.geofenceManager = geofenceManager;\n      this.cloudSync = cloudSync;\n      this.stationService = stationService;\n      this.trackingStatus = {\n        isActive: false,\n        nativeGeofencing: false,\n        jsGeofencing: false,\n        backgroundMode: false,\n        cloudSync: false,\n        activeRegions: 0,\n        lastLocationUpdate: null,\n        batteryOptimized: true\n      };\n      this.geofenceStats = {\n        activeRegions: 0,\n        maxRegions: 20,\n        nearbyStations: 0,\n        totalStations: 0,\n        lastOptimization: null\n      };\n      this.syncStatus = {\n        isOnline: false,\n        lastSync: null,\n        pendingEvents: 0,\n        syncErrors: 0,\n        totalEventsSynced: 0\n      };\n      this.currentLocation = null;\n      this.nearbyStations = [];\n      this.todayVisits = [];\n      this.isInitializing = false;\n      this.subscriptions = [];\n    }\n    ngOnInit() {\n      var _this = this;\n      return _asyncToGenerator(function* () {\n        try {\n          _this.isInitializing = true;\n          // Initialize integrated geofence system\n          yield _this.integratedGeofence.initialize();\n          // Subscribe to tracking status\n          _this.subscriptions.push(_this.integratedGeofence.getTrackingStatus().subscribe(status => {\n            _this.trackingStatus = status;\n          }));\n          // Subscribe to geofence statistics\n          _this.subscriptions.push(_this.geofenceManager.getStats().subscribe(stats => {\n            _this.geofenceStats = stats;\n          }));\n          // Subscribe to cloud sync status\n          _this.subscriptions.push(_this.cloudSync.getSyncStatus().subscribe(status => {\n            _this.syncStatus = status;\n          }));\n          // Subscribe to current location\n          _this.subscriptions.push(_this.geofenceManager.getCurrentLocation().subscribe(location => {\n            _this.currentLocation = location;\n            if (location) {\n              _this.loadNearbyStations(location.latitude, location.longitude);\n            }\n          }));\n          // Load today's visits\n          yield _this.loadTodayVisits();\n        } catch (error) {\n          console.error('Failed to initialize home page:', error);\n        } finally {\n          _this.isInitializing = false;\n        }\n      })();\n    }\n    ngOnDestroy() {\n      this.subscriptions.forEach(sub => sub.unsubscribe());\n    }\n    toggleTracking() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          if (_this2.trackingStatus.isActive) {\n            yield _this2.integratedGeofence.stopTracking();\n          } else {\n            const success = yield _this2.integratedGeofence.startTracking();\n            if (!success) {\n              console.error('Failed to start integrated tracking');\n              // Show error message to user\n            }\n          }\n        } catch (error) {\n          console.error('Failed to toggle tracking:', error);\n          // Show error message to user\n        }\n      })();\n    }\n    loadNearbyStations(lat, lng) {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          _this3.nearbyStations = (yield _this3.stationService.getNearbyStations(lat, lng).toPromise()) || [];\n        } catch (error) {\n          console.error('Failed to load nearby stations:', error);\n        }\n      })();\n    }\n    loadTodayVisits() {\n      var _this4 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const today = new Date();\n          const startOfDay = new Date(today.getFullYear(), today.getMonth(), today.getDate());\n          const endOfDay = new Date(startOfDay);\n          endOfDay.setDate(endOfDay.getDate() + 1);\n          _this4.todayVisits = (yield _this4.stationService.getVisitsByDateRange(startOfDay.toISOString(), endOfDay.toISOString()).toPromise()) || [];\n        } catch (error) {\n          console.error('Failed to load today visits:', error);\n        }\n      })();\n    }\n    // New methods for integrated system\n    forceOptimization() {\n      var _this5 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          yield _this5.geofenceManager.forceOptimization();\n          console.log('Manual optimization completed');\n        } catch (error) {\n          console.error('Manual optimization failed:', error);\n        }\n      })();\n    }\n    forcSync() {\n      var _this6 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          yield _this6.cloudSync.forcSync();\n          console.log('Manual sync completed');\n        } catch (error) {\n          console.error('Manual sync failed:', error);\n        }\n      })();\n    }\n    getSystemStatus() {\n      var _this7 = this;\n      return _asyncToGenerator(function* () {\n        try {\n          const status = yield _this7.integratedGeofence.getSystemStatus();\n          console.log('System status:', status);\n          return status;\n        } catch (error) {\n          console.error('Failed to get system status:', error);\n          return null;\n        }\n      })();\n    }\n    getTrackingStatusColor() {\n      if (!this.trackingStatus.isActive) return 'medium';\n      if (this.trackingStatus.nativeGeofencing && this.trackingStatus.backgroundMode) return 'success';\n      if (this.trackingStatus.jsGeofencing) return 'warning';\n      return 'danger';\n    }\n    getSyncStatusColor() {\n      if (!this.syncStatus.isOnline) return 'danger';\n      if (this.syncStatus.pendingEvents > 10) return 'warning';\n      if (this.syncStatus.syncErrors > 5) return 'warning';\n      return 'success';\n    }\n    getBatteryOptimizationColor() {\n      return this.trackingStatus.batteryOptimized ? 'success' : 'warning';\n    }\n    // Removed old unused methods\n    formatEventTime(timestamp) {\n      return new Date(timestamp).toLocaleTimeString('ja-JP', {\n        hour: '2-digit',\n        minute: '2-digit',\n        second: '2-digit'\n      });\n    }\n    getEventIcon(type) {\n      return type === 'enter' ? 'log-in' : 'log-out';\n    }\n    getEventColor(type) {\n      return type === 'enter' ? 'success' : 'warning';\n    }\n    calculateDistance(station) {\n      if (!this.currentLocation) return null;\n      const R = 6371e3; // Earth's radius in meters\n      const φ1 = this.currentLocation.latitude * Math.PI / 180;\n      const φ2 = station.latitude * Math.PI / 180;\n      const Δφ = (station.latitude - this.currentLocation.latitude) * Math.PI / 180;\n      const Δλ = (station.longitude - this.currentLocation.longitude) * Math.PI / 180;\n      const a = Math.sin(Δφ / 2) * Math.sin(Δφ / 2) + Math.cos(φ1) * Math.cos(φ2) * Math.sin(Δλ / 2) * Math.sin(Δλ / 2);\n      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n      return Math.round(R * c); // Distance in meters\n    }\n    static #_ = _staticBlock = () => (this.ɵfac = function HomePage_Factory(__ngFactoryType__) {\n      return new (__ngFactoryType__ || HomePage)(i0.ɵɵdirectiveInject(i1.IntegratedGeofenceService), i0.ɵɵdirectiveInject(i2.GeofenceManagerService), i0.ɵɵdirectiveInject(i3.CloudSyncService), i0.ɵɵdirectiveInject(i4.StationService));\n    }, this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: HomePage,\n      selectors: [[\"app-home\"]],\n      decls: 26,\n      vars: 15,\n      consts: [[3, \"translucent\"], [3, \"fullscreen\"], [\"collapse\", \"condense\"], [\"size\", \"large\"], [4, \"ngIf\"], [2, \"margin-left\", \"10px\", 3, \"color\"], [\"expand\", \"block\", 3, \"click\", \"color\", \"disabled\"], [\"class\", \"tracking-details\", 4, \"ngIf\"], [\"class\", \"status-info\", 4, \"ngIf\"], [\"type\", \"indeterminate\"], [1, \"tracking-details\"], [\"lines\", \"none\"], [3, \"color\"], [\"color\", \"primary\"], [1, \"status-info\"], [\"lines\", \"none\", 4, \"ngIf\"], [\"expand\", \"block\", \"fill\", \"outline\", 3, \"click\"], [\"expand\", \"block\", \"fill\", \"outline\", 3, \"click\", \"disabled\"], [4, \"ngFor\", \"ngForOf\"], [2, \"text-align\", \"center\", \"padding\", \"40px\"], [\"name\", \"location-outline\", \"size\", \"large\", \"color\", \"medium\"], [\"color\", \"primary\", \"size\", \"large\", 3, \"click\"], [\"name\", \"play\", \"slot\", \"start\"]],\n      template: function HomePage_Template(rf, ctx) {\n        if (rf & 1) {\n          i0.ɵɵelementStart(0, \"ion-header\", 0)(1, \"ion-toolbar\")(2, \"ion-title\");\n          i0.ɵɵtext(3, \"\\u99C5\\u8A18\\u9332\\u30A2\\u30D7\\u30EA - \\u30D0\\u30C3\\u30AF\\u30B0\\u30E9\\u30A6\\u30F3\\u30C9\\u5BFE\\u5FDC\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(4, \"ion-content\", 1)(5, \"ion-header\", 2)(6, \"ion-toolbar\")(7, \"ion-title\", 3);\n          i0.ɵɵtext(8, \"\\u99C5\\u8A18\\u9332\\u30A2\\u30D7\\u30EA\");\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵtemplate(9, HomePage_ion_card_9_Template, 5, 0, \"ion-card\", 4);\n          i0.ɵɵelementStart(10, \"ion-card\")(11, \"ion-card-header\")(12, \"ion-card-title\");\n          i0.ɵɵtext(13, \" \\u7D71\\u5408\\u4F4D\\u7F6E\\u8FFD\\u8DE1\\u30B7\\u30B9\\u30C6\\u30E0 \");\n          i0.ɵɵelementStart(14, \"ion-badge\", 5);\n          i0.ɵɵtext(15);\n          i0.ɵɵelementEnd()()();\n          i0.ɵɵelementStart(16, \"ion-card-content\")(17, \"ion-button\", 6);\n          i0.ɵɵlistener(\"click\", function HomePage_Template_ion_button_click_17_listener() {\n            return ctx.toggleTracking();\n          });\n          i0.ɵɵtext(18);\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(19, HomePage_div_19_Template, 21, 8, \"div\", 7)(20, HomePage_div_20_Template, 6, 9, \"div\", 8);\n          i0.ɵɵelementEnd()();\n          i0.ɵɵtemplate(21, HomePage_ion_card_21_Template, 30, 11, \"ion-card\", 4)(22, HomePage_ion_card_22_Template, 11, 1, \"ion-card\", 4)(23, HomePage_ion_card_23_Template, 7, 2, \"ion-card\", 4)(24, HomePage_ion_card_24_Template, 7, 2, \"ion-card\", 4)(25, HomePage_ion_card_25_Template, 10, 0, \"ion-card\", 4);\n          i0.ɵɵelementEnd();\n        }\n        if (rf & 2) {\n          i0.ɵɵproperty(\"translucent\", true);\n          i0.ɵɵadvance(4);\n          i0.ɵɵproperty(\"fullscreen\", true);\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"ngIf\", ctx.isInitializing);\n          i0.ɵɵadvance(5);\n          i0.ɵɵproperty(\"color\", ctx.getTrackingStatusColor());\n          i0.ɵɵadvance();\n          i0.ɵɵtextInterpolate1(\" \", ctx.trackingStatus.isActive ? \"\\u30A2\\u30AF\\u30C6\\u30A3\\u30D6\" : \"\\u505C\\u6B62\\u4E2D\", \" \");\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"color\", ctx.trackingStatus.isActive ? \"danger\" : \"primary\")(\"disabled\", ctx.isInitializing);\n          i0.ɵɵadvance();\n          i0.ɵɵtextInterpolate1(\" \", ctx.trackingStatus.isActive ? \"\\u30D0\\u30C3\\u30AF\\u30B0\\u30E9\\u30A6\\u30F3\\u30C9\\u8FFD\\u8DE1\\u505C\\u6B62\" : \"\\u30D0\\u30C3\\u30AF\\u30B0\\u30E9\\u30A6\\u30F3\\u30C9\\u8FFD\\u8DE1\\u958B\\u59CB\", \" \");\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.trackingStatus.isActive);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.currentLocation);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.trackingStatus.isActive);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.trackingStatus.isActive);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.nearbyStations.length > 0);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.todayVisits.length > 0);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", !ctx.trackingStatus.isActive && !ctx.isInitializing);\n        }\n      },\n      dependencies: [CommonModule, i5.NgForOf, i5.NgIf, IonHeader, IonToolbar, IonTitle, IonContent, IonButton, IonCard, IonCardContent, IonCardHeader, IonCardTitle, IonIcon, IonItem, IonLabel, IonBadge, IonList, IonProgressBar, i5.DecimalPipe, i5.DatePipe],\n      styles: [\".tracking-status[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.location-info[_ngcontent-%COMP%]{margin-top:16px;padding:12px;background:var(--ion-color-light);border-radius:8px}.location-info[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0 0 8px;font-family:monospace;font-size:.9em;color:var(--ion-color-medium)}.stats-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px;text-align:center}.stat-item[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:2em;font-weight:700}.stat-item[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:4px 0 0;font-size:.9em;text-transform:uppercase;letter-spacing:.5px}.empty-state[_ngcontent-%COMP%]{text-align:center;padding:40px 20px}.empty-state[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-bottom:16px}.empty-state[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:var(--ion-color-dark);margin:0 0 8px}.empty-state[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin:0 0 24px}ion-chip[_ngcontent-%COMP%]{--background: var(--ion-color-light)}ion-list[_ngcontent-%COMP%]{padding:0}ion-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{margin:12px 0}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 4px;font-weight:600}ion-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:2px 0;font-size:.9em}.tracking-status[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]{transition:all .3s ease}.tracking-status[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{transition:all .3s ease}\"]\n    }));\n  }\n  _staticBlock();\n  return HomePage;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}